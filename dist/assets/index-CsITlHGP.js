(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function d(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(e){if(e.ep)return;e.ep=!0;const o=d(e);fetch(e.href,o)}})();class Oe{constructor(r=0){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[],this.perm=[],this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[1,0,3,2],[1,0,2,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,1,0],[2,3,0,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,1,3,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,2,0],[3,1,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,2,1,0],[3,2,0,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.p=new Array(256);for(let e=0;e<256;e++)this.p[e]=e;let d,t;for(let e=255;e>0;e--)d=Math.floor((r=(r*9301+49297)%233280)/233280*(e+1)),t=this.p[e],this.p[e]=this.p[d],this.p[d]=t;this.perm=new Array(512);for(let e=0;e<512;e++)this.perm[e]=this.p[e&255]}dot(r,d,t,e){return r[0]*d+r[1]*t+r[2]*e}noise(r,d,t){const e=.3333333333333333,o=1/6;let i,p,g,v,h=(r+d+t)*e,c=Math.floor(r+h),l=Math.floor(d+h),u=Math.floor(t+h),S=(c+l+u)*o,F=c-S,T=l-S,R=u-S,w=r-F,E=d-T,z=t-R,L,n,m,B,I,X;w>=E?E>=z?(L=1,n=0,m=0,B=1,I=1,X=0):w>=z?(L=1,n=0,m=0,B=1,I=0,X=1):(L=0,n=0,m=1,B=1,I=0,X=1):E<z?(L=0,n=0,m=1,B=0,I=1,X=1):w<z?(L=0,n=1,m=0,B=0,I=1,X=1):(L=0,n=1,m=0,B=1,I=1,X=0);let Q=w-L+o,ee=E-n+o,te=z-m+o,ce=w-B+2*o,pe=E-I+2*o,ge=z-X+2*o,ae=w-1+3*o,ie=E-1+3*o,oe=z-1+3*o,a=c&255,f=l&255,x=u&255,b=this.perm[a+this.perm[f+this.perm[x]]]%12,A=this.perm[a+L+this.perm[f+n+this.perm[x+m]]]%12,P=this.perm[a+B+this.perm[f+I+this.perm[x+X]]]%12,C=this.perm[a+1+this.perm[f+1+this.perm[x+1]]]%12,G=.6-w*w-E*E-z*z;i=G<0?0:(G*=G)*G*this.dot(this.grad3[b],w,E,z);let N=.6-Q*Q-ee*ee-te*te;p=N<0?0:(N*=N)*N*this.dot(this.grad3[A],Q,ee,te);let _=.6-ce*ce-pe*pe-ge*ge;g=_<0?0:(_*=_)*_*this.dot(this.grad3[P],ce,pe,ge);let O=.6-ae*ae-ie*ie-oe*oe;return v=O<0?0:(O*=O)*O*this.dot(this.grad3[C],ae,ie,oe),32*(i+p+g+v)}}function Be(s=3,r=20908800,d=1e-6,t){const e=(1+Math.sqrt(5))/2;let o=[[-1,e,0],[1,e,0],[-1,-e,0],[1,-e,0],[0,-1,e],[0,1,e],[0,-1,-e],[0,1,-e],[e,0,-1],[e,0,1],[-e,0,-1],[-e,0,1]];o=o.map(([c,l,u])=>{const S=Math.hypot(c,l,u);return[c/S,l/S,u/S]});let i=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];const p=new Map;function g(c,l){const u=c<l?`${c}_${l}`:`${l}_${c}`;if(p.has(u))return p.get(u);const[S,F,T]=o[c],[R,w,E]=o[l],z=(S+R)/2,L=(F+w)/2,n=(T+E)/2,m=Math.hypot(z,L,n),B=[z/m,L/m,n/m];o.push(B);const I=o.length-1;return p.set(u,I),I}for(let c=0;c<s;c++){const l=[];for(const[u,S,F]of i){const T=g(u,S),R=g(S,F),w=g(F,u);l.push([u,T,w],[S,R,T],[F,w,R],[T,R,w])}i=l}const v=[];for(const[c,l,u]of o){let S=0;const F=(r+S)*d;v.push(c*F,l*F,u*F,S)}const h=[];for(const[c,l,u]of i)h.push(c,l,u);return{vertices:new Float32Array(v),indices:new Uint32Array(h)}}const ye=document.getElementById("oceanSAPercent"),Ie=document.getElementById("oceanSAPercentValue"),Pe=document.getElementById("volumeRatio");function Se(s){if(s<=0||s>=1)throw new Error("p must be in (0,1)");const r=-39.6968302866538,d=220.946098424521,t=-275.928510446969,e=138.357751867269,o=-30.6647980661472,i=2.50662827745924,p=-54.4760987982241,g=161.585836858041,v=-155.698979859887,h=66.8013118877197,c=-13.2806815528857,l=-.00778489400243029,u=-.322396458041136,S=-2.40075827716184,F=-2.54973253934373,T=4.37466414146497,R=2.93816398269878,w=.00778469570904146,E=.32246712907004,z=2.445134137143,L=3.75440866190742;let n,m;return s<.02425?(n=Math.sqrt(-2*Math.log(s)),(((((l*n+u)*n+S)*n+F)*n+T)*n+R)/((((w*n+E)*n+z)*n+L)*n+1)):s>1-.02425?(n=Math.sqrt(-2*Math.log(1-s)),-(((((l*n+u)*n+S)*n+F)*n+T)*n+R)/((((w*n+E)*n+z)*n+L)*n+1)):(n=s-.5,m=n*n,(((((r*m+d)*m+t)*m+e)*m+o)*m+i)*n/(((((p*m+g)*m+v)*m+h)*m+c)*m+1))}function $(s,r,d){return Math.max(r,Math.min(d,s))}function Ue(s,r,d){const t=$((d-s)/(r-s),0,1);return t*t*(3-2*t)}function we(s,r,d,t,e,o){let i=0,p=1,g=0,v=o;e=Math.max(1,Math.floor(e));for(let h=0;h<e;h++){const c=h*19.1,l=h*47.7,u=h*73.3;i+=p*t.noise(s*v+c,r*v+l,d*v+u),g+=p,p*=.5,v*=2}return g>0?i/g:0}function Ve(s,r){const d=Math.floor(s.length/4),t=new Float32Array(d*3);for(let e=0;e<r.length;e+=3){const o=r[e+0],i=r[e+1],p=r[e+2],g=s[o*4+0],v=s[o*4+1],h=s[o*4+2],c=s[i*4+0],l=s[i*4+1],u=s[i*4+2],S=s[p*4+0],F=s[p*4+1],T=s[p*4+2],R=c-g,w=l-v,E=u-h,z=S-g,L=F-v,n=T-h,m=w*n-E*L,B=E*z-R*n,I=R*L-w*z;t[o*3+0]+=m,t[o*3+1]+=B,t[o*3+2]+=I,t[i*3+0]+=m,t[i*3+1]+=B,t[i*3+2]+=I,t[p*3+0]+=m,t[p*3+1]+=B,t[p*3+2]+=I}for(let e=0;e<d;e++){let o=t[e*3+0],i=t[e*3+1],p=t[e*3+2],g=Math.hypot(o,i,p);if(!Number.isFinite(g)||g<1e-12){const v=s[e*4+0],h=s[e*4+1],c=s[e*4+2];g=Math.hypot(v,h,c)||1,o=v/g,i=h/g,p=c/g}else o/=g,i/=g,p/=g;t[e*3+0]=o,t[e*3+1]=i,t[e*3+2]=p}return t}const ze=20889115,Re=0,xe=48685,Ae=-16404,Me=1e-6,Te=10,Fe=4;function Ce(s,r,d,t){const e=we(s,r,d,t,3,.65),o=Ue(-.15,.25,e),i=we(s,r,d,t,6,2.6),p=.85*e+.45*i*(.25+.75*o);return $(p,-1,1)}async function Ge(){const s=navigator.gpu;if(!s){document.body.innerHTML="WebGPU not supported.";return}const r=document.getElementById("webgpu-canvas");if(!r)throw new Error('Canvas element with id "webgpu-canvas" not found.');const d=await s.requestAdapter();if(!d)throw new Error("No GPU adapter found");const t=await d.requestDevice(),e=r.getContext("webgpu"),o=s.getPreferredCanvasFormat();e.configure({device:t,format:o});const i=(()=>{var a;if((a=globalThis.crypto)!=null&&a.getRandomValues){const f=new Uint32Array(1);return globalThis.crypto.getRandomValues(f),f[0]/2**32*1e4}return Math.random()*1e4})(),p=new Oe(i);console.log("noiseSeed:",i);let g=Number(ye.value)/100,v=0,h,c,l,u;function S(){let a=1/0,f=-1/0,x=0,b=0,A=0,P=0,C=0,G=0,N=0,_=0,O=0,K=0,D=0,k=0,H=0;function Y(y,q){const J=Math.abs(Ae)/q,re=xe/q,se=J/(J+re),W=1e-6,fe=$(y,W,1-W);let M,de;if(fe<se){const he=$(fe/(2*se),W,.5-W);M=Se(he),de=J}else{const he=$(.5+(fe-se)/(2*(1-se)),.5+W,1-W);M=Se(he),de=re}return M=$(M,-q,q),{elevFeet:$(Re+de*M,Ae,xe),zStd:M}}v=Y(g,Fe).elevFeet;const U=Be(8,1,1),V=U.vertices.length/4,j=new Array(V),ne=new Array(V);for(let y=0;y<V;y++){const q=U.vertices[y*4+0],J=U.vertices[y*4+1],re=U.vertices[y*4+2];j[y]=Ce(q,J,re,p),ne[y]=y}ne.sort((y,q)=>j[y]-j[q]);const le=new Array(V);for(let y=0;y<V;y++){const q=ne[y];le[q]=(y+.5)/V}const Z=new Float32Array(U.vertices.length);for(let y=0;y<V;y++){const q=U.vertices[y*4+0],J=U.vertices[y*4+1],re=U.vertices[y*4+2],se=q,W=J,fe=re,{elevFeet:M,zStd:de}=Y(le[y],Fe);M<a&&(a=M),M>f&&(f=M),C++;const me=Math.abs(de);me>=1&&G++,me>=2&&N++,me>=3&&_++,me>=4&&O++,M<0?x++:b++,M<=Ae&&A++,M>=xe&&P++,M<v?(K++,k+=v-M):(D++,H+=M-v);const he=M<v?v:M,ve=(ze+he*Te)*Me;Z[y*4+0]=se*ve,Z[y*4+1]=W*ve,Z[y*4+2]=fe*ve,Z[y*4+3]=M}h={vertices:Z,indices:U.indices};const ue=Ve(Z,U.indices);c?t.queue.writeBuffer(c,0,h.vertices):(c=t.createBuffer({size:h.vertices.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(c.getMappedRange()).set(h.vertices),c.unmap()),l?t.queue.writeBuffer(l,0,ue.buffer,ue.byteOffset,ue.byteLength):(l=t.createBuffer({size:ue.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(l.getMappedRange()).set(ue),l.unmap()),u?t.queue.writeBuffer(u,0,h.indices):(u=t.createBuffer({size:h.indices.byteLength,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint32Array(u.getMappedRange()).set(h.indices),u.unmap());const Ee=K>0?k/K:0,Le=D>0?H/D:0,be=V>0?K/V:0;return console.log("***************************************"),console.log("Total Vertices:",C),console.log("Vertices < 0:",x),console.log("Vertices >= 0:",b),console.log("|z| >= 1:",G),console.log("|z| >= 2:",N),console.log("|z| >= 3:",_),console.log("|z| >= 4:",O),console.log("Vertices clamped low:",A),console.log("Vertices clamped high:",P),console.log("Highest elevation (feet):",f),console.log("Lowest elevation (feet):",a),console.log("Approx ocean surface area %:",(be*100).toFixed(2)),console.log("Sea Level:",v),{avgOceanDepthFeet:Ee,avgLandHeightFeet:Le,oceanFracActual:be}}function F(){const a=Number(ye.value)/100;g=$(Number.isFinite(a)?a:0,0,1);const f=S(),x=f.oceanFracActual,A=(1-x)*f.avgLandHeightFeet,P=A>0?x*f.avgOceanDepthFeet/A:1/0;Ie.textContent=ye.value;const C=Number.isFinite(P)?P.toFixed(2):"âˆž";Pe.textContent=` | Ocean:Land Volume Ratio = ${C}:1`}F(),ye.addEventListener("input",F);function T(a,f,x,b){const A=1/Math.tan(a/2),P=1/(x-b);return new Float32Array([A/f,0,0,0,0,A,0,0,0,0,(b+x)*P,-1,0,0,2*b*x*P,0])}function R(a,f,x){const[b,A,P]=a,[C,G,N]=f,[_,O,K]=x;let D=b-C,k=A-G,H=P-N,Y=Math.hypot(D,k,H);D/=Y,k/=Y,H/=Y;let U=O*H-K*k,V=K*D-_*H,j=_*k-O*D;Y=Math.hypot(U,V,j),U/=Y,V/=Y,j/=Y;let ne=k*j-H*V,le=H*U-D*j,Z=D*V-k*U;return new Float32Array([U,ne,D,0,V,le,k,0,j,Z,H,0,-(U*b+V*A+j*P),-(ne*b+le*A+Z*P),-(D*b+k*A+H*P),1])}const w=r.width/r.height,E=T(Math.PI/2.2,w,.01,800);let z=35;const n=ze*Me*1.001,m=500;r.addEventListener("wheel",a=>{a.preventDefault();const f=.0015,x=a.shiftKey?3:1;z=$(z*Math.exp(a.deltaY*f*x),n,m)},{passive:!1});function B(a,f){const x=new Float32Array(16);for(let b=0;b<4;++b)for(let A=0;A<4;++A)x[A*4+b]=a[b]*f[A*4]+a[4+b]*f[A*4+1]+a[8+b]*f[A*4+2]+a[12+b]*f[A*4+3];return x}function I(a){const f=Math.cos(a),x=Math.sin(a);return new Float32Array([f,0,x,0,0,1,0,0,-x,0,f,0,0,0,0,1])}function X(a){return I(a)}let Q=t.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),ee=t.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const te=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),ce=t.createBindGroup({layout:te,entries:[{binding:0,resource:{buffer:Q}},{binding:1,resource:{buffer:ee}}]}),ae=t.createRenderPipeline({layout:t.createPipelineLayout({bindGroupLayouts:[te]}),vertex:{module:t.createShaderModule({code:`
    struct Uniforms { mvp: mat4x4<f32>, model: mat4x4<f32> };
    @group(0) @binding(0) var<uniform> uniforms: Uniforms;
    struct VertexOut {
      @builtin(position) pos: vec4<f32>,
      @location(0) elev: f32,
      @location(1) nrm: vec3<f32>,
    };
    @vertex
    fn main(@location(0) position: vec3<f32>, @location(1) elevation: f32, @location(2) normal: vec3<f32>) -> VertexOut {
      var out: VertexOut;
      out.pos = uniforms.mvp * vec4<f32>(position, 1.0);
      out.elev = elevation;
      out.nrm = normalize((uniforms.model * vec4<f32>(normal, 0.0)).xyz);
      return out;
    }
  `}),entryPoint:"main",buffers:[{arrayStride:16,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32"}]},{arrayStride:12,attributes:[{shaderLocation:2,offset:0,format:"float32x3"}]}]},fragment:{module:t.createShaderModule({code:`
    @group(0) @binding(1) var<uniform> zSea: f32;
    @fragment
    fn main(@location(0) elev: f32, @location(1) nrm: vec3<f32>) -> @location(0) vec4<f32> {
      let lightDir = normalize(vec3<f32>(0.35, 0.85, 0.4));
      let ndotl = max(dot(normalize(nrm), lightDir), 0.0);
      let ambient = 0.22;
      let shade = ambient + (1.0 - ambient) * ndotl;
        // Additional code can go here

      // Color stops
      let deepOcean = vec3<f32>(0.05, 0.15, 0.4);
      let midOcean  = vec3<f32>(0.1, 0.3, 0.7);
      let shallowOcean = vec3<f32>(0.2, 0.5, 1.0);
      let lowLand   = vec3<f32>(0.2, 0.36, 0.2);
      let highLand  = vec3<f32>(0.3, 0.2, 0.1);
      let rocky     = vec3<f32>(0.4, 0.4, 0.4);
      let snow      = vec3<f32>(1.0, 1.0, 1.0);

      var color: vec3<f32>;

      if (elev < zSea - 15000.0) {
        // Deep to mid ocean
        let t = smoothstep(zSea - 25000.0, zSea - 15000.0, elev);
        color = mix(deepOcean, midOcean, t);
      } else if (elev < zSea - 6000.0) {
        // Mid to shallow ocean
        let t = smoothstep(zSea - 15000.0, zSea - 6000.0, elev);
        color = mix(midOcean, shallowOcean, t);
      } else if (elev < zSea) {
        // Shallow ocean (no gradient to low land)
        color = shallowOcean;
      } else if (elev < zSea + 12000.0) {
        // Low land to highland
        let t = smoothstep(zSea, zSea + 12000.0, elev);
        color = mix(lowLand, highLand, t);
      } else if (elev < zSea + 17000.0) {
        // Highland to rocky
        let t = smoothstep(zSea + 12000.0, zSea + 17000.0, elev);
        color = mix(highLand, rocky, t);
      } else {
        // Rocky to snow
        let t = smoothstep(zSea + 18000.0, zSea + 25000.0, elev);
        color = mix(rocky, snow, t);
      }
      return vec4<f32>(color * shade, 1.0);
    }
  `}),entryPoint:"main",targets:[{format:o}]},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"triangle-list",cullMode:"back"}});let ie=t.createTexture({size:{width:r.width,height:r.height,depthOrArrayLayers:1},format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});function oe(a){const f=(a||0)*4e-4,x=X(f),b=R([0,0,z],[0,0,0],[0,1,0]),A=B(b,x),P=B(E,A),C=new Float32Array(32);C.set(P,0),C.set(x,16),t.queue.writeBuffer(Q,0,C.buffer,C.byteOffset,C.byteLength);const G=new Float32Array([v]);t.queue.writeBuffer(ee,0,G.buffer,G.byteOffset,G.byteLength);const N=t.createCommandEncoder(),_=e.getCurrentTexture().createView(),O=N.beginRenderPass({colorAttachments:[{view:_,clearValue:{r:.05,g:.05,b:.1,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:ie.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});O.setPipeline(ae),O.setBindGroup(0,ce),O.setVertexBuffer(0,c),O.setVertexBuffer(1,l),O.setIndexBuffer(u,"uint32"),O.drawIndexed(h.indices.length),O.end(),t.queue.submit([N.finish()]),requestAnimationFrame(oe)}requestAnimationFrame(oe)}Ge();
