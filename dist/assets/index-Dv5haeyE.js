(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function f(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(e){if(e.ep)return;e.ep=!0;const o=f(e);fetch(e.href,o)}})();class Be{constructor(n=0){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[],this.perm=[],this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[1,0,3,2],[1,0,2,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,1,0],[2,3,0,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,1,3,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,2,0],[3,1,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,2,1,0],[3,2,0,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.p=new Array(256);for(let e=0;e<256;e++)this.p[e]=e;let f,t;for(let e=255;e>0;e--)f=Math.floor((n=(n*9301+49297)%233280)/233280*(e+1)),t=this.p[e],this.p[e]=this.p[f],this.p[f]=t;this.perm=new Array(512);for(let e=0;e<512;e++)this.perm[e]=this.p[e&255]}dot(n,f,t,e){return n[0]*f+n[1]*t+n[2]*e}noise(n,f,t){const e=.3333333333333333,o=1/6;let a,p,d,y,m=(n+f+t)*e,c=Math.floor(n+m),i=Math.floor(f+m),l=Math.floor(t+m),A=(c+i+l)*o,L=c-A,B=i-A,U=l-A,b=n-L,F=f-B,x=t-U,z,r,h,I,O,X;b>=F?F>=x?(z=1,r=0,h=0,I=1,O=1,X=0):b>=x?(z=1,r=0,h=0,I=1,O=0,X=1):(z=0,r=0,h=1,I=1,O=0,X=1):F<x?(z=0,r=0,h=1,I=0,O=1,X=1):b<x?(z=0,r=1,h=0,I=0,O=1,X=1):(z=0,r=1,h=0,I=1,O=1,X=0);let ce=b-z+o,ee=F-r+o,te=x-h+o,oe=b-I+2*o,ae=F-O+2*o,ge=x-X+2*o,ye=b-1+3*o,ie=F-1+3*o,le=x-1+3*o,K=c&255,u=i&255,v=l&255,M=this.perm[K+this.perm[u+this.perm[v]]]%12,S=this.perm[K+z+this.perm[u+r+this.perm[v+h]]]%12,w=this.perm[K+I+this.perm[u+O+this.perm[v+X]]]%12,C=this.perm[K+1+this.perm[u+1+this.perm[v+1]]]%12,T=.6-b*b-F*F-x*x;a=T<0?0:(T*=T)*T*this.dot(this.grad3[M],b,F,x);let G=.6-ce*ce-ee*ee-te*te;p=G<0?0:(G*=G)*G*this.dot(this.grad3[S],ce,ee,te);let R=.6-oe*oe-ae*ae-ge*ge;d=R<0?0:(R*=R)*R*this.dot(this.grad3[w],oe,ae,ge);let _=.6-ye*ye-ie*ie-le*le;return y=_<0?0:(_*=_)*_*this.dot(this.grad3[C],ye,ie,le),32*(a+p+d+y)}}function Ve(s=3,n=20908800,f=1e-6,t){const e=(1+Math.sqrt(5))/2;let o=[[-1,e,0],[1,e,0],[-1,-e,0],[1,-e,0],[0,-1,e],[0,1,e],[0,-1,-e],[0,1,-e],[e,0,-1],[e,0,1],[-e,0,-1],[-e,0,1]];o=o.map(([c,i,l])=>{const A=Math.hypot(c,i,l);return[c/A,i/A,l/A]});let a=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];const p=new Map;function d(c,i){const l=c<i?`${c}_${i}`:`${i}_${c}`;if(p.has(l))return p.get(l);const[A,L,B]=o[c],[U,b,F]=o[i],x=(A+U)/2,z=(L+b)/2,r=(B+F)/2,h=Math.hypot(x,z,r),I=[x/h,z/h,r/h];o.push(I);const O=o.length-1;return p.set(l,O),O}for(let c=0;c<s;c++){const i=[];for(const[l,A,L]of a){const B=d(l,A),U=d(A,L),b=d(L,l);i.push([l,B,b],[A,U,B],[L,b,U],[B,U,b])}a=i}const y=[];for(const[c,i,l]of o){let A=0;const L=(n+A)*f;y.push(c*L,i*L,l*L,A)}const m=[];for(const[c,i,l]of a)m.push(c,i,l);return{vertices:new Float32Array(y),indices:new Uint32Array(m)}}const ve=document.getElementById("oceanSAPercent"),Ie=document.getElementById("oceanSAPercentValue");function xe(s){if(s<=0||s>=1)throw new Error("p must be in (0,1)");const n=-39.6968302866538,f=220.946098424521,t=-275.928510446969,e=138.357751867269,o=-30.6647980661472,a=2.50662827745924,p=-54.4760987982241,d=161.585836858041,y=-155.698979859887,m=66.8013118877197,c=-13.2806815528857,i=-.00778489400243029,l=-.322396458041136,A=-2.40075827716184,L=-2.54973253934373,B=4.37466414146497,U=2.93816398269878,b=.00778469570904146,F=.32246712907004,x=2.445134137143,z=3.75440866190742;let r,h;return s<.02425?(r=Math.sqrt(-2*Math.log(s)),(((((i*r+l)*r+A)*r+L)*r+B)*r+U)/((((b*r+F)*r+x)*r+z)*r+1)):s>1-.02425?(r=Math.sqrt(-2*Math.log(1-s)),-(((((i*r+l)*r+A)*r+L)*r+B)*r+U)/((((b*r+F)*r+x)*r+z)*r+1)):(r=s-.5,h=r*r,(((((n*h+f)*h+t)*h+e)*h+o)*h+a)*r/(((((p*h+d)*h+y)*h+m)*h+c)*h+1))}function $(s,n,f){return Math.max(n,Math.min(f,s))}function Pe(s,n,f){const t=$((f-s)/(n-s),0,1);return t*t*(3-2*t)}function ze(s,n,f,t,e,o){let a=0,p=1,d=0,y=o;e=Math.max(1,Math.floor(e));for(let m=0;m<e;m++){const c=m*19.1,i=m*47.7,l=m*73.3;a+=p*t.noise(s*y+c,n*y+i,f*y+l),d+=p,p*=.5,y*=2}return d>0?a/d:0}function Ue(s,n){const f=Math.floor(s.length/4),t=new Float32Array(f*3);for(let e=0;e<n.length;e+=3){const o=n[e+0],a=n[e+1],p=n[e+2],d=s[o*4+0],y=s[o*4+1],m=s[o*4+2],c=s[a*4+0],i=s[a*4+1],l=s[a*4+2],A=s[p*4+0],L=s[p*4+1],B=s[p*4+2],U=c-d,b=i-y,F=l-m,x=A-d,z=L-y,r=B-m,h=b*r-F*z,I=F*x-U*r,O=U*z-b*x;t[o*3+0]+=h,t[o*3+1]+=I,t[o*3+2]+=O,t[a*3+0]+=h,t[a*3+1]+=I,t[a*3+2]+=O,t[p*3+0]+=h,t[p*3+1]+=I,t[p*3+2]+=O}for(let e=0;e<f;e++){let o=t[e*3+0],a=t[e*3+1],p=t[e*3+2],d=Math.hypot(o,a,p);if(!Number.isFinite(d)||d<1e-12){const y=s[e*4+0],m=s[e*4+1],c=s[e*4+2];d=Math.hypot(y,m,c)||1,o=y/d,a=m/d,p=c/d}else o/=d,a/=d,p/=d;t[e*3+0]=o,t[e*3+1]=a,t[e*3+2]=p}return t}const Me=20889115,Te=0,be=48685,Se=-16404,Ee=1e-6,Ce=10,Le=4;function Ge(s,n,f,t){const e=ze(s,n,f,t,3,.65),o=Pe(-.15,.25,e),a=ze(s,n,f,t,6,2.6),p=.85*e+.45*a*(.25+.75*o),d=.15*(1-Math.abs(n));return $(p+d,-1,1)}async function Ne(){const s=navigator.gpu;if(!s){document.body.innerHTML="WebGPU not supported.";return}const n=document.getElementById("webgpu-canvas");if(!n)throw new Error('Canvas element with id "webgpu-canvas" not found.');const f=await s.requestAdapter();if(!f)throw new Error("No GPU adapter found");const t=await f.requestDevice(),e=n.getContext("webgpu"),o=s.getPreferredCanvasFormat();e.configure({device:t,format:o});const a=(()=>{var u;if((u=globalThis.crypto)!=null&&u.getRandomValues){const v=new Uint32Array(1);return globalThis.crypto.getRandomValues(v),v[0]/2**32*1e4}return Math.random()*1e4})(),p=new Be(a);console.log("noiseSeed:",a);let d=Number(ve.value)/100,y=0,m,c,i,l;function A(){let u=1/0,v=-1/0,M=0,S=0,w=0,C=0,T=0,G=0,R=0,_=0,N=0,J=0,D=0,k=0,H=0;function Y(g,q){const Q=Math.abs(Se)/q,re=be/q,se=Q/(Q+re),W=1e-6,de=$(g,W,1-W);let E,he;if(de<se){const pe=$(de/(2*se),W,.5-W);E=xe(pe),he=Q}else{const pe=$(.5+(de-se)/(2*(1-se)),.5+W,1-W);E=xe(pe),he=re}return E=$(E,-q,q),{elevFeet:$(Te+he*E,Se,be),zStd:E}}y=Y(d,Le).elevFeet;const V=Ve(8,1,1),P=V.vertices.length/4,j=new Array(P),ne=new Array(P);for(let g=0;g<P;g++){const q=V.vertices[g*4+0],Q=V.vertices[g*4+1],re=V.vertices[g*4+2];j[g]=Ge(q,Q,re,p),ne[g]=g}console.time("rawValues sort"),ne.sort((g,q)=>j[g]-j[q]),console.timeEnd("rawValues sort");const ue=new Array(P);for(let g=0;g<P;g++){const q=ne[g];ue[q]=(g+.5)/P}const Z=new Float32Array(V.vertices.length);for(let g=0;g<P;g++){const q=V.vertices[g*4+0],Q=V.vertices[g*4+1],re=V.vertices[g*4+2],se=q,W=Q,de=re,{elevFeet:E,zStd:he}=Y(ue[g],Le);E<u&&(u=E),E>v&&(v=E),T++;const me=Math.abs(he);me>=1&&G++,me>=2&&R++,me>=3&&_++,me>=4&&N++,E<0?M++:S++,E<=Se&&w++,E>=be&&C++,E<y?(J++,k+=y-E):(D++,H+=E-y);const pe=E<y?y:E,Ae=(Me+pe*Ce)*Ee;Z[g*4+0]=se*Ae,Z[g*4+1]=W*Ae,Z[g*4+2]=de*Ae,Z[g*4+3]=E}m={vertices:Z,indices:V.indices};const fe=Ue(Z,V.indices);c?t.queue.writeBuffer(c,0,m.vertices):(c=t.createBuffer({size:m.vertices.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(c.getMappedRange()).set(m.vertices),c.unmap()),i?t.queue.writeBuffer(i,0,fe.buffer,fe.byteOffset,fe.byteLength):(i=t.createBuffer({size:fe.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(i.getMappedRange()).set(fe),i.unmap()),l?t.queue.writeBuffer(l,0,m.indices):(l=t.createBuffer({size:m.indices.byteLength,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint32Array(l.getMappedRange()).set(m.indices),l.unmap());const Fe=J>0?k/J:0,Oe=D>0?H/D:0,we=P>0?J/P:0;return console.log("***************************************"),console.log("Total Vertices:",T),console.log("Vertices < 0:",M),console.log("Vertices >= 0:",S),console.log("|z| >= 1:",G),console.log("|z| >= 2:",R),console.log("|z| >= 3:",_),console.log("|z| >= 4:",N),console.log("Vertices clamped low:",w),console.log("Vertices clamped high:",C),console.log("Highest elevation (feet):",v),console.log("Lowest elevation (feet):",u),console.log("Approx ocean surface area %:",(we*100).toFixed(4)),console.log("Sea Level:",y),{avgOceanDepthFeet:Fe,avgLandHeightFeet:Oe,oceanFracActual:we}}function L(){d=Number(ve.value)/100,Ie.textContent=ve.value,A()}L();let B;ve.addEventListener("input",()=>{B!==void 0&&clearTimeout(B),B=window.setTimeout(()=>{L(),B=void 0},500)});function U(u,v,M,S){const w=1/Math.tan(u/2),C=1/(M-S);return new Float32Array([w/v,0,0,0,0,w,0,0,0,0,(S+M)*C,-1,0,0,2*S*M*C,0])}function b(u,v,M){const[S,w,C]=u,[T,G,R]=v,[_,N,J]=M;let D=S-T,k=w-G,H=C-R,Y=Math.hypot(D,k,H);D/=Y,k/=Y,H/=Y;let V=N*H-J*k,P=J*D-_*H,j=_*k-N*D;Y=Math.hypot(V,P,j),V/=Y,P/=Y,j/=Y;let ne=k*j-H*P,ue=H*V-D*j,Z=D*P-k*V;return new Float32Array([V,ne,D,0,P,ue,k,0,j,Z,H,0,-(V*S+P*w+j*C),-(ne*S+ue*w+Z*C),-(D*S+k*w+H*C),1])}const F=n.width/n.height,x=U(Math.PI/2.2,F,.01,800);let z=35;const h=Me*Ee*1.001,I=500;n.addEventListener("wheel",u=>{u.preventDefault();const v=.0015,M=u.shiftKey?3:1;z=$(z*Math.exp(u.deltaY*v*M),h,I)},{passive:!1});function O(u,v){const M=new Float32Array(16);for(let S=0;S<4;++S)for(let w=0;w<4;++w)M[w*4+S]=u[S]*v[w*4]+u[4+S]*v[w*4+1]+u[8+S]*v[w*4+2]+u[12+S]*v[w*4+3];return M}function X(u){const v=Math.cos(u),M=Math.sin(u);return new Float32Array([v,0,M,0,0,1,0,0,-M,0,v,0,0,0,0,1])}function ce(u){return X(u)}let ee=t.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),te=t.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const oe=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),ae=t.createBindGroup({layout:oe,entries:[{binding:0,resource:{buffer:ee}},{binding:1,resource:{buffer:te}}]}),ie=t.createRenderPipeline({layout:t.createPipelineLayout({bindGroupLayouts:[oe]}),vertex:{module:t.createShaderModule({code:`
    struct Uniforms { mvp: mat4x4<f32>, model: mat4x4<f32> };
    @group(0) @binding(0) var<uniform> uniforms: Uniforms;
    struct VertexOut {
      @builtin(position) pos: vec4<f32>,
      @location(0) elev: f32,
      @location(1) nrm: vec3<f32>,
    };
    @vertex
    fn main(@location(0) position: vec3<f32>, @location(1) elevation: f32, @location(2) normal: vec3<f32>) -> VertexOut {
      var out: VertexOut;
      out.pos = uniforms.mvp * vec4<f32>(position, 1.0);
      out.elev = elevation;
      out.nrm = normalize((uniforms.model * vec4<f32>(normal, 0.0)).xyz);
      return out;
    }
  `}),entryPoint:"main",buffers:[{arrayStride:16,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32"}]},{arrayStride:12,attributes:[{shaderLocation:2,offset:0,format:"float32x3"}]}]},fragment:{module:t.createShaderModule({code:`
    @group(0) @binding(1) var<uniform> zSea: f32;
    @fragment
    fn main(@location(0) elev: f32, @location(1) nrm: vec3<f32>) -> @location(0) vec4<f32> {
      let lightDir = normalize(vec3<f32>(0.35, 0.85, 0.4));
      let ndotl = max(dot(normalize(nrm), lightDir), 0.0);
      let ambient = 0.4; //increases overall light
      let shade = ambient + (1.0 - ambient) * ndotl;
        // Additional code can go here

      // Color stops
      let deepOcean = vec3<f32>(0.05, 0.15, 0.4);
      let midOcean  = vec3<f32>(0.1, 0.3, 0.7);
      let shallowOcean = vec3<f32>(0.2, 0.5, 1.0);
      let lowLand   = vec3<f32>(0.2, 0.36, 0.2);
      let highLand  = vec3<f32>(0.3, 0.2, 0.1);
      let rocky     = vec3<f32>(0.4, 0.4, 0.4);
      let snow      = vec3<f32>(1.0, 1.0, 1.0);

      var color: vec3<f32>;

      if (elev < zSea - 15000.0) {
        // Deep to mid ocean
        let t = smoothstep(zSea - 25000.0, zSea - 15000.0, elev);
        color = mix(deepOcean, midOcean, t);
      } else if (elev < zSea - 6000.0) {
        // Mid to shallow ocean
        let t = smoothstep(zSea - 15000.0, zSea - 6000.0, elev);
        color = mix(midOcean, shallowOcean, t);
      } else if (elev < zSea) {
        // Shallow ocean (no gradient to low land)
        color = shallowOcean;
      } else if (elev < zSea + 12000.0) {
        // Low land to highland
        let t = smoothstep(zSea, zSea + 12000.0, elev);
        color = mix(lowLand, highLand, t);
      } else if (elev < zSea + 17000.0) {
        // Highland to rocky
        let t = smoothstep(zSea + 12000.0, zSea + 17000.0, elev);
        color = mix(highLand, rocky, t);
      } else {
        // Rocky to snow
        let t = smoothstep(zSea + 18000.0, zSea + 25000.0, elev);
        color = mix(rocky, snow, t);
      }
      return vec4<f32>(color * shade, 1.0);
    }
  `}),entryPoint:"main",targets:[{format:o}]},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"triangle-list",cullMode:"back"}});let le=t.createTexture({size:{width:n.width,height:n.height,depthOrArrayLayers:1},format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});function K(u){const v=(u||0)*2e-4,M=ce(v),S=b([0,0,z],[0,0,0],[0,1,0]),w=O(S,M),C=O(x,w),T=new Float32Array(32);T.set(C,0),T.set(M,16),t.queue.writeBuffer(ee,0,T.buffer,T.byteOffset,T.byteLength);const G=new Float32Array([y]);t.queue.writeBuffer(te,0,G.buffer,G.byteOffset,G.byteLength);const R=t.createCommandEncoder(),_=e.getCurrentTexture().createView(),N=R.beginRenderPass({colorAttachments:[{view:_,clearValue:{r:.05,g:.05,b:.1,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:le.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});N.setPipeline(ie),N.setBindGroup(0,ae),N.setVertexBuffer(0,c),N.setVertexBuffer(1,i),N.setIndexBuffer(l,"uint32"),N.drawIndexed(m.indices.length),N.end(),t.queue.submit([R.finish()]),requestAnimationFrame(K)}requestAnimationFrame(K)}Ne();
